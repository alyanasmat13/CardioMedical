<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="styles.css" />
    <link rel="icon" type="image/x-icon" href="/images/logos/Cardio Only Logo.png" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - Cardio Medical</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="scripts/supabase-config.js"></script>
  </head>
  <body>
    <div class="header">
      <a id="cardio" href="index.html">Cardio Medical</a>
      <div class="header-right">
        <a href="index.html">Home</a>
        <a href="team.html">Our Team</a>
        <a href="podcast.html">Podcast</a>
        <a href="#">Resources</a>
        <a href="database.html">Database</a>
        <a href="#">Articles</a>
        <a href="about.html">About Us</a>
      </div>
    </div>
    <div class="logo">
      <img src="images/logos/Cardio Only Logo.png" alt="Cardio Medical Logo"/>
    </div>

    <div class="login-intro">
      <h1>Login</h1>

      <div id="message"></div>

      <form id="loginForm" class="login-form">
        <label for="email">Email</label>
        <input type="email" id="email"placeholder="Enter Email" required>

        <label for="password">Password</label>
        <input type="password" id="password" placeholder="Enter Password" required>

        <p>Only authorized members can login.</p>

        <button type="submit" class="login-btn" id="loginBtn">Sign In</button>
      </form>
    </div>

    <div class="footer">
      <div class="minifooter">
        <a id="footertoptext">Cardio Medical</a>
        <div class="media">
          <div class="social-media">
            <p>Follow Us On Social Media:</p>
            <i class="fa fa-facebook-square"></i>
            <i class="fa fa-instagram"></i>
            <i class="fa fa-linkedin-square"></i>
          </div>
          <div class="contact-info">
            <p>Contact Us!</p>
            <p>Email: <a href="mailto:alyanasmat13@gmail.com">Us Here </a></p>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 Cardio Medical. All rights reserved.</p>
      </div>
    </div>

    <script>
        // Check if user is already logged in
        document.addEventListener('DOMContentLoaded', async function() {
            const { data: { session } } = await supabase.auth.getSession()
            if (session) {
                // User is already logged in, redirect to blog admin
                window.location.href = 'blog-admin.html';
            }
        });

        // Handle login form submission
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;
            const loginBtn = document.getElementById('loginBtn');

            // Update button state
            loginBtn.disabled = true;
            loginBtn.textContent = 'Signing in...';

            try {
                // First check if email is in approved members list
                const memberResult = await checkMembershipStatus(email);
                if (!memberResult.ok) {
                    throw new Error(memberResult.error?.message || 'Membership check failed');
                }
                if (!memberResult.data) {
                    throw new Error('Email not found in approved members list. Please contact an administrator.');
                }

                // Attempt login
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });

                if (error) {
                    throw error;
                }

                showMessage('Login successful! Redirecting...', 'success');
                
                // Redirect to blog admin page after successful login
                setTimeout(() => {
                    window.location.href = 'blog-admin.html';
                }, 1500);

            } catch (error) {
                showMessage('Login failed: ' + error.message, 'error');
            } finally {
                loginBtn.disabled = false;
                loginBtn.textContent = 'Sign In';
            }
        });

        // Show message to user
        function showMessage(message, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = `<div class="message ${type}">${message}</div>`;
            
            if (type === 'success') {
                setTimeout(() => {
                    messageDiv.innerHTML = '';
                }, 3000);
            }
        }
    </script>
    
  </body>
</html>
